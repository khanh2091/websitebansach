<template>
    <div >
        <div id="content">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div id="main-slider" class="owl-carousel owl-theme">
                            <div class="item">
                                <img id="myimg0" alt="" class="img-fluid" />
                            </div>
                            <div class="item">
                                <img id="myimg1" alt="" class="img-fluid" />
                            </div>
                            <div class="item">
                                <img id="myimg2" alt="" class="img-fluid" />
                            </div>
                            <div class="item">
                                <img id="myimg3" alt="" class="img-fluid" />
                            </div>
                        </div>
                        <!-- /#main-slider-->
                    </div>
                </div>
            </div>
            <!--
        *** ADVANTAGES HOMEPAGE ***
        _________________________________________________________
        -->
            <div id="advantages">
                <div class="container">
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div
                                class="box clickable d-flex flex-column justify-content-center mb-0 h-100"
                            >
                                <div class="icon">
                                    <i class="fa fa-heart"></i>
                                </div>
                                <h3>
                                    <a href="#">We love our customers</a>
                                </h3>
                                <p class="mb-0">
                                    We are known to provide best possible
                                    service ever
                                </p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div
                                class="box clickable d-flex flex-column justify-content-center mb-0 h-100"
                            >
                                <div class="icon">
                                    <i class="fa fa-tags"></i>
                                </div>
                                <h3><a href="#">Best prices</a></h3>
                                <p class="mb-0">
                                    You can check that the height of the boxes
                                    adjust when longer text like this one is
                                    used in one of them.
                                </p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div
                                class="box clickable d-flex flex-column justify-content-center mb-0 h-100"
                            >
                                <div class="icon">
                                    <i class="fa fa-thumbs-up"></i>
                                </div>
                                <h3>
                                    <a href="#">100% satisfaction guaranteed</a>
                                </h3>
                                <p class="mb-0">
                                    Free returns on everything for 3 months.
                                </p>
                            </div>
                        </div>
                    </div>
                    <!-- /.row-->
                </div>
                <!-- /.container-->
            </div>
            <!-- /#advantages-->
            <!-- *** ADVANTAGES END ***-->
            <!--
        *** HOT PRODUCT SLIDESHOW ***
        _________________________________________________________
        -->
            <div>
                <div class="box py-4">
                    <div class="container">
                        <div class="row">
                            <div class="col-md-12">
                                <h2 class="mb-0">Hot this week</h2>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="container">
                    <div class="row products">
                        <div class="col-lg-3 col-md-4" v-for="book in books.data">
                            <div class="product">
                                <div class="flip-container">
                                    <div class="flipper">
                                        <div class="front">
                                            <a href="detail.html"
                                                >{{ showImage(book.images, book.ma) }}<img
                                                    :id="book.ma"
                                                    style="height: 337px; width: 253px;"
                                                    class="img-fluid"
                                            /></a>
                                        </div>
                                        <div class="back">
                                            <a href="detail.html"
                                                >{{ showImage(book.images, book.ma) }}<img
                                                    :id="book.ma"
                                                    style="height: 337px; width: 253px;"
                                                    class="img-fluid"
                                            /></a>
                                        </div>
                                    </div>
                                </div>
                                </div><a href="detail.html" class="invisible"><img src="img/product1.jpg" alt="" class="img-fluid"></a>
                                <div class="text">
                                    <h3>
                                        <a href="detail.html"
                                            >{{book.title}}</a
                                        >
                                    </h3>
                                    <p class="price"><del></del>{{ book.price }} VNƒê</p>
                                    <p class="buttons">
                                        <a
                                            href="detail.html"
                                            class="btn btn-outline-secondary"
                                            >View detail</a
                                        ><a
                                            href="basket.html"
                                            class="btn btn-primary"
                                            ><i class="fa fa-shopping-cart"></i
                                            >Add to cart</a
                                        >
                                    </p>
                                </div>
                                <!-- /.text-->
                            </div>
                            <!-- /.product            -->
                        </div>

                        <!-- /.products-->
                    </div>
                </div>

                <!-- /#hot-->
                <!-- *** HOT END ***-->
            </div>
            <!--
        *** GET INSPIRED ***
        _________________________________________________________
        -->
            <div class="container">
                <div class="col-md-12">
                    <div class="box slideshow">
                        <h3>Get Inspired</h3>
                        <p class="lead">
                            Get the inspiration from our world class designers
                        </p>
                        <div id="get-inspired" class="owl-carousel owl-theme">
                            <div class="item">
                                <a href="#"
                                    ><img
                                        src="img/getinspired1.jpg"
                                        alt="Get inspired"
                                        class="img-fluid"
                                /></a>
                            </div>
                            <div class="item">
                                <a href="#"
                                    ><img
                                        src="img/getinspired2.jpg"
                                        alt="Get inspired"
                                        class="img-fluid"
                                /></a>
                            </div>
                            <div class="item">
                                <a href="#"
                                    ><img
                                        src="img/getinspired3.jpg"
                                        alt="Get inspired"
                                        class="img-fluid"
                                /></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- *** GET INSPIRED END ***-->
            <!--
        *** BLOG HOMEPAGE ***
        _________________________________________________________
        -->
            <div class="box text-center">
                <div class="container">
                    <div class="col-md-12">
                        <h3 class="text-uppercase">From our blog</h3>
                        <p class="lead mb-0">
                            What's new in the world of fashion?
                            <a href="blog.html">Check our blog!</a>
                        </p>
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="col-md-12">
                    <div id="blog-homepage" class="row">
                        <div class="col-sm-6">
                            <div class="post">
                                <h4><a href="post.html">Fashion now</a></h4>
                                <p class="author-category">
                                    By <a href="#">John Slim</a> in
                                    <a href="">Fashion and style</a>
                                </p>
                                <hr />
                                <p class="intro">
                                    Pellentesque habitant morbi tristique
                                    senectus et netus et malesuada fames ac
                                    turpis egestas. Vestibulum tortor quam,
                                    feugiat vitae, ultricies eget, tempor sit
                                    amet, ante. Donec eu libero sit amet quam
                                    egestas semper. Aenean ultricies mi vitae
                                    est. Mauris placerat eleifend leo.
                                </p>
                                <p class="read-more">
                                    <a href="post.html" class="btn btn-primary"
                                        >Continue reading</a
                                    >
                                </p>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="post">
                                <h4>
                                    <a href="post.html"
                                        >Who is who - example blog post</a
                                    >
                                </h4>
                                <p class="author-category">
                                    By <a href="#">John Slim</a> in
                                    <a href="">About Minimal</a>
                                </p>
                                <hr />
                                <p class="intro">
                                    Pellentesque habitant morbi tristique
                                    senectus et netus et malesuada fames ac
                                    turpis egestas. Vestibulum tortor quam,
                                    feugiat vitae, ultricies eget, tempor sit
                                    amet, ante. Donec eu libero sit amet quam
                                    egestas semper. Aenean ultricies mi vitae
                                    est. Mauris placerat eleifend leo.
                                </p>
                                <p class="read-more">
                                    <a href="post.html" class="btn btn-primary"
                                        >Continue reading</a
                                    >
                                </p>
                            </div>
                        </div>
                    </div>
                    <!-- /#blog-homepage-->
                </div>
            </div>
            <!-- /.container-->
            <!-- *** BLOG HOMEPAGE END ***-->
        </div>
    </div>
</template>
<script>
import axios from "axios";
import swal from "sweetalert";
import DatePicker from "vue2-datepicker";
import "vue2-datepicker/index.css";
import EventBus from "../EventBus.vue";
import { getStorage, ref, listAll, getDownloadURL } from "firebase/storage";
export default {
    components: { DatePicker },
    data() {
        return {
            books: {},
            urlbanner: [],
            tacgia: [],
            theloai: [],
            ngonngu: [],
            nhaxuatban: [],
        };
    },
    mounted() {
        this.loadBanner();
        this.loadBook();
    },
    methods: {
        showImage(fileName, id) {
            const storage = getStorage();
            getDownloadURL(ref(storage, fileName))
                .then((url) => {
                    // `url` is the download URL for 'images/stars.jpg'

                    // This can be downloaded directly:
                    const xhr = new XMLHttpRequest();
                    xhr.responseType = "blob";
                    xhr.onload = (event) => {
                        const blob = xhr.response;
                    };
                    xhr.open("GET", url);
                    xhr.send();
                    // Or inserted into an <img> element
                    const img = document.getElementById(id);
                    img.setAttribute("src", url);
                })
                .catch((error) => {
                    // Handle any errors
                });
        },
        loadBanner() {
            var dem = 0;
            const storage = getStorage();
            // Create a reference under which you want to list
            const listRef = ref(storage, "/banner");

            // Find all the prefixes and items.
            listAll(listRef)
                .then((res) => {
                    res.prefixes.forEach((folderRef) => {
                        // All the prefixes under listRef.
                        // You may call listAll() recursively on them.
                    });
                    res.items.forEach((itemRef) => {
                        // All the items under listRef.
                        console.log(itemRef.name);
                        getDownloadURL(ref(storage, "banner/" + itemRef.name))
                            .then((url) => {
                                // `url` is the download URL for 'images/stars.jpg'

                                // This can be downloaded directly:
                                const xhr = new XMLHttpRequest();
                                xhr.responseType = "blob";
                                xhr.onload = (event) => {
                                    const blob = xhr.response;
                                };
                                xhr.open("GET", url);
                                xhr.send();

                                // Or inserted into an <img> element
                                const img = document.getElementById(
                                    "myimg" + dem
                                );
                                img.setAttribute("src", url);
                                dem = dem + 1;
                                console(dem);
                            })
                            .catch((error) => {
                                // Handle any errors
                            });
                    });
                })
                .catch((error) => {
                    // Uh-oh, an error occurred!
                });
        },
        loadBook: function () {
            axios
                .get("/api/admin/all_category")
                .then((response) => {
                    this.theloai = response.data;
                })
                .catch(function (error) {
                    console.log(error);
                });
            axios
                .get("/api/admin/all_language")
                .then((response) => {
                    this.ngonngu = response.data;
                })
                .catch(function (error) {
                    console.log(error);
                });
            axios
                .get("/api/admin/all_author")
                .then((response) => {
                    this.tacgia = response.data;
                })
                .catch(function (error) {
                    console.log(error);
                });
            axios
                .get("/api/admin/all_publisher")
                .then((response) => {
                    this.nhaxuatban = response.data;
                })
                .catch(function (error) {
                    console.log(error);
                });
            axios
                .get("/api/admin/all_book")
                .then((response) => {
                    this.books = response;
                    console.log(this.books);
                })
                .catch(function (error) {
                    console.log(error);
                });
        },
    },
};
</script>
